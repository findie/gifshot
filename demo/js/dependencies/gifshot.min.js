/*Copyrights for code authored by Yahoo Inc. is licensed under the following terms:
MIT License
Copyright  2017 Yahoo Inc.
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
!function(e,t,r,i){"use strict";function n(){return Q.isValid()}function o(){return Q.isValid()}function a(){var e={getUserMedia:!0};return Q.isValid(e)}function s(e){var t=!1;if(X.isArray(e)&&e.length){if(X.each(e,function(e,r){X.isSupported.videoCodecs[r]&&(t=!0)}),!t)return!1}else if(X.isString(e)&&e.length&&!X.isSupported.videoCodecs[e])return!1;return Q.isValid({getUserMedia:!0})}function l(){function e(e,t,r){var i,n;for(u=e,c=t,f=r,g=new Array(m),i=0;m>i;i++)g[i]=new Array(4),n=g[i],n[0]=n[1]=n[2]=(i<<C+8)/m|0,B[i]=F/m|0,G[i]=0}function t(){for(var e=[],t=new Array(m),r=0;m>r;r++)t[g[r][3]]=r;for(var i=0,n=0;m>n;n++){var o=t[n];e[i++]=g[o][0],e[i++]=g[o][1],e[i++]=g[o][2]}return e}function r(){var e,t,r,i,n,o,a,s;for(a=0,s=0,e=0;m>e;e++){for(n=g[e],r=e,i=n[1],t=e+1;m>t;t++)o=g[t],o[1]<i&&(r=t,i=o[1]);if(o=g[r],e!=r&&(t=o[0],o[0]=n[0],n[0]=t,t=o[1],o[1]=n[1],n[1]=t,t=o[2],o[2]=n[2],n[2]=t,t=o[3],o[3]=n[3],n[3]=t),i!=a){for(V[a]=s+e>>1,t=a+1;i>t;t++)V[t]=e;a=i,s=e}}for(V[a]=s+y>>1,t=a+1;256>t;t++)V[t]=y}function i(){var e,t,r,i,n,o,a,g,m,y,S,F,M,A;for(w>c&&(f=1),d=30+(f-1)/3,F=u,M=0,A=c,S=c/(3*f),y=S/k|0,g=j,o=T,a=o>>W,1>=a&&(a=0),e=0;a>e;e++)q[e]=g*((a*a-e*e)*P/(a*a));for(m=w>c?3:c%p!==0?3*p:c%v!==0?3*v:c%b!==0?3*b:3*x,e=0;S>e;)if(r=(255&F[M+0])<<C,i=(255&F[M+1])<<C,n=(255&F[M+2])<<C,t=h(r,i,n),l(g,t,r,i,n),0!==a&&s(a,t,r,i,n),M+=m,M>=A&&(M-=c),e++,0===y&&(y=1),e%y===0)for(g-=g/d,o-=o/R,a=o>>W,1>=a&&(a=0),t=0;a>t;t++)q[t]=g*((a*a-t*t)*P/(a*a))}function n(e,t,r){var i,n,o,a,s,l,h;for(s=1e3,h=-1,i=V[t],n=i-1;m>i||n>=0;)m>i&&(l=g[i],o=l[1]-t,o>=s?i=m:(i++,0>o&&(o=-o),a=l[0]-e,0>a&&(a=-a),o+=a,s>o&&(a=l[2]-r,0>a&&(a=-a),o+=a,s>o&&(s=o,h=l[3])))),n>=0&&(l=g[n],o=t-l[1],o>=s?n=-1:(n--,0>o&&(o=-o),a=l[0]-e,0>a&&(a=-a),o+=a,s>o&&(a=l[2]-r,0>a&&(a=-a),o+=a,s>o&&(s=o,h=l[3]))));return h}function o(){return i(),a(),r(),t()}function a(){var e;for(e=0;m>e;e++)g[e][0]>>=C,g[e][1]>>=C,g[e][2]>>=C,g[e][3]=e}function s(e,t,r,i,n){var o,a,s,l,h,d,u;for(s=t-e,-1>s&&(s=-1),l=t+e,l>m&&(l=m),o=t+1,a=t-1,d=1;l>o||a>s;){if(h=q[d++],l>o){u=g[o++];try{u[0]-=h*(u[0]-r)/L|0,u[1]-=h*(u[1]-i)/L|0,u[2]-=h*(u[2]-n)/L|0}catch(c){}}if(a>s){u=g[a--];try{u[0]-=h*(u[0]-r)/L|0,u[1]-=h*(u[1]-i)/L|0,u[2]-=h*(u[2]-n)/L|0}catch(c){}}}}function l(e,t,r,i,n){var o=g[t],a=e/j;o[0]-=a*(o[0]-r)|0,o[1]-=a*(o[1]-i)|0,o[2]-=a*(o[2]-n)|0}function h(e,t,r){var i,n,o,a,s,l,h,d,u,c;for(d=~(1<<31),u=d,l=-1,h=l,i=0;m>i;i++)c=g[i],n=c[0]-e,0>n&&(n=-n),o=c[1]-t,0>o&&(o=-o),n+=o,o=c[2]-r,0>o&&(o=-o),n+=o,d>n&&(d=n,l=i),a=n-(G[i]>>S-C),u>a&&(u=a,h=i),s=B[i]>>A,B[i]-=s,G[i]+=s<<M;return B[l]+=O,G[l]-=E,h}var d,u,c,f,g,m=256,p=499,v=491,b=487,x=503,w=3*x,y=m-1,C=4,k=100,S=16,F=1<<S,M=10,A=10,O=F>>A,E=F<<M-A,I=m>>3,W=6,U=1<<W,T=I*U,R=30,D=10,j=1<<D,H=8,P=1<<H,z=D+H,L=1<<z,V=[],G=[],B=[],q=[];e.apply(this,arguments);var N={};return N.map=n,N.process=o,N}function h(){var e=this;try{e.onmessage=function(e){var t,i=e.data||{};i.gifshot&&(t=r.run(i),postMessage(t))}}catch(t){}var r={dataToRGB:function(e,t,r){for(var i=t*r*4,n=0,o=[];i>n;)o.push(e[n++]),o.push(e[n++]),o.push(e[n++]),n++;return o},componentizedPaletteToArray:function(e){e=e||[];for(var t=[],r=0;r<e.length;r+=3){var i=e[r],n=e[r+1],o=e[r+2];t.push(i<<16|n<<8|o)}return t},processFrameWithQuantizer:function(e,t,r,i){for(var n=this.dataToRGB(e,t,r),o=new l(n,n.length,i),a=o.process(),s=new Uint32Array(this.componentizedPaletteToArray(a)),h=t*r,d=new Uint8Array(h),u=0,c=0;h>c;c++){var f=n[u++],g=n[u++],m=n[u++];d[c]=o.map(f,g,m)}return{pixels:d,palette:s}},run:function(e){e=e||{};var t=e,r=t.height,i=(t.palette,t.sampleInterval),n=t.width,o=e.data;return this.processFrameWithQuantizer(o,n,r,i)}};return r}function d(e,t,r,n){function o(e){var t=e.length;if(2>t||t>256||t&t-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return t}function a(e,t,r,n){function o(r){for(;f>=r;)e[t++]=255&g,g>>=8,f-=8,t===s+256&&(e[s]=255,s=t++)}function a(e){g|=e<<f,f+=c,o(8)}e[t++]=r;var s=t++,l=1<<r,h=l-1,d=l+1,u=d+1,c=r+1,f=0,g=0,m=n[0]&h,p={};a(l);for(var v=1,b=n.length;b>v;++v){var x=n[v]&h,w=m<<8|x,y=p[w];if(y===i){for(g|=m<<f,f+=c;f>=8;)e[t++]=255&g,g>>=8,f-=8,t===s+256&&(e[s]=255,s=t++);4096===u?(a(l),u=d+1,c=r+1,p={}):(u>=1<<c&&++c,p[w]=u++),m=x}else m=y}return a(m),a(d),o(1),s+1===t?e[s]=0:(e[s]=t-s-1,e[t++]=0),t}var s=0;n=n===i?{}:n;var l=n.loop===i?null:n.loop,h=n.palette===i?null:n.palette;if(0>=t||0>=r||t>65535||r>65535)throw"Width/Height invalid.";e[s++]=71,e[s++]=73,e[s++]=70,e[s++]=56,e[s++]=57,e[s++]=97;var d=0,u=0;if(e[s++]=255&t,e[s++]=t>>8&255,e[s++]=255&r,e[s++]=r>>8&255,e[s++]=(null!==h?128:0)|d,e[s++]=u,e[s++]=0,null!==l){if(0>l||l>65535)throw"Loop count invalid.";e[s++]=33,e[s++]=255,e[s++]=11,e[s++]=78,e[s++]=69,e[s++]=84,e[s++]=83,e[s++]=67,e[s++]=65,e[s++]=80,e[s++]=69,e[s++]=50,e[s++]=46,e[s++]=48,e[s++]=3,e[s++]=1,e[s++]=255&l,e[s++]=l>>8&255,e[s++]=0}var c=!1;this.addFrame=function(t,r,n,l,d,u){if(c===!0&&(--s,c=!1),u=u===i?{}:u,0>t||0>r||t>65535||r>65535)throw"x/y invalid.";if(0>=n||0>=l||n>65535||l>65535)throw"Width/Height invalid.";if(d.length<n*l)throw"Not enough pixels for the frame size.";var f=!0,g=u.palette;if((g===i||null===g)&&(f=!1,g=h),g===i||null===g)throw"Must supply either a local or global palette.";for(var m=o(g),p=0;m>>=1;)++p;m=1<<p;var v=u.delay===i?0:u.delay,b=u.disposal===i?0:u.disposal;if(0>b||b>3)throw"Disposal out of range.";var x=!1,w=0;if(u.transparent!==i&&null!==u.transparent&&(x=!0,w=u.transparent,0>w||w>=m))throw"Transparent color index.";if((0!==b||x||0!==v)&&(e[s++]=33,e[s++]=249,e[s++]=4,e[s++]=b<<2|(x===!0?1:0),e[s++]=255&v,e[s++]=v>>8&255,e[s++]=w,e[s++]=0),e[s++]=44,e[s++]=255&t,e[s++]=t>>8&255,e[s++]=255&r,e[s++]=r>>8&255,e[s++]=255&n,e[s++]=n>>8&255,e[s++]=255&l,e[s++]=l>>8&255,e[s++]=f===!0?128|p-1:0,f===!0)for(var y=0,C=g.length;C>y;++y){var k=g[y];e[s++]=k>>16&255,e[s++]=k>>8&255,e[s++]=255&k}s=a(e,s,2>p?2:p,d)},this.end=function(){return c===!1&&(e[s++]=59,c=!0),s}}function u(e,t){e.getBase64GIF(function(e){t({error:!1,errorCode:"",errorMsg:"",image:e})})}function c(){function e(){X.each(d,function(e,t){t&&(t.text?g.addFrame(t.img,a,t.text):g.addFrame(t,a))}),u(g,n)}var r=arguments.length>0&&arguments[0]!==i?arguments[0]:{},n=r.callback,o=r.images,a=r.options,s=r.imagesLength,l={getUserMedia:!0,"window.URL":!0},h=Q.validate(l),d=[],c=0,f=void 0,g=void 0;return h.error?n(h):(g=new et(a),X.each(o,function(r,i){var o=i;i.src&&(o=o.src),X.isElement(o)?(a.crossOrigin&&(o.crossOrigin=a.crossOrigin),d[r]=o,c+=1,c===s&&e()):X.isString(o)&&(f=new Image,a.crossOrigin&&(f.crossOrigin=a.crossOrigin),function(t){i.text&&(t.text=i.text),t.onerror=function(){var e=void 0;return--s,0===s?(e={},e.error="None of the requested images was capable of being retrieved",n(e)):void 0},t.onload=function(){d[r]=i.text?{img:t,text:t.text}:t,c+=1,c===s&&e(),X.removeElement(t)},t.src=o}(f),X.setCSSAttr(f,{position:"fixed",opacity:"0"}),t.body.appendChild(f))}),void 0)}function f(e){if(e=e||{},this.method=e.method||2,this.colors=e.colors||256,this.initColors=e.initColors||4096,this.initDist=e.initDist||.01,this.distIncr=e.distIncr||.005,this.hueGroups=e.hueGroups||10,this.satGroups=e.satGroups||10,this.lumGroups=e.lumGroups||10,this.minHueCols=e.minHueCols||0,this.hueStats=this.minHueCols?new g(this.hueGroups,this.minHueCols):null,this.boxSize=e.boxSize||[64,64],this.boxPxls=e.boxPxls||2,this.palLocked=!1,this.dithKern=e.dithKern||null,this.dithSerp=e.dithSerp||!1,this.dithDelta=e.dithDelta||0,this.histogram={},this.idxrgb=e.palette?e.palette.slice(0):[],this.idxi32=[],this.i32idx={},this.i32rgb={},this.useCache=e.useCache!==!1,this.cacheFreq=e.cacheFreq||10,this.reIndex=e.reIndex||0==this.idxrgb.length,this.colorDist="manhattan"==e.colorDist?v:p,this.idxrgb.length>0){var t=this;this.idxrgb.forEach(function(e,r){var i=(255<<24|e[2]<<16|e[1]<<8|e[0])>>>0;t.idxi32[r]=i,t.i32idx[i]=r,t.i32rgb[i]=e})}}function g(e,t){this.numGroups=e,this.minCols=t,this.stats={};for(var r=-1;e>r;r++)this.stats[r]={num:0,cols:[]};this.groupsFull=0}function m(e,t,r){return Math.sqrt(tt*e*e+rt*t*t+it*r*r)}function p(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(tt*r*r+rt*i*i+it*n*n)/st}function v(e,t){var r=Math.abs(t[0]-e[0]),i=Math.abs(t[1]-e[1]),n=Math.abs(t[2]-e[2]);return(tt*r+rt*i+it*n)/lt}function b(e,t,r){var i,n,o,a,s,l;if(e/=255,t/=255,r/=255,i=Math.max(e,t,r),n=Math.min(e,t,r),s=(i+n)/2,i==n)o=a=0;else{switch(l=i-n,a=s>.5?l/(2-i-n):l/(i+n),i){case e:o=(t-r)/l+(r>t?6:0);break;case t:o=(r-e)/l+2;break;case r:o=(e-t)/l+4}o/=6}return{h:o,s:a,l:m(e,t,r)}}function x(e,t){var r=1/t,i=r/2;if(e>=1-i||i>=e)return 0;for(var n=1;t>n;n++){var o=n*r;if(e>=o-i&&o+i>=e)return n}}function w(e){return e}function y(e){return e}function C(e){return Object.prototype.toString.call(e).slice(8,-1)}function k(e){var t=C(this[0]);if("Number"==t||"String"==t){for(var r,i={},n=this.length,o=0;n>o;o++)r=this[o],i[r]||0===i[r]||(i[r]=o);return this.sort(function(t,r){return e(t,r)||i[t]-i[r]})}var i=this.map(function(e){return e});return this.sort(function(t,r){return e(t,r)||i.indexOf(t)-i.indexOf(r)})}function S(){var e="abcdefghijklmnopqrstuvwxyz";return"xyzvwtursopqmnklhijfgdeabc"==e.split("").sort(function(t,r){return~~(e.indexOf(r)/2.3)-~~(e.indexOf(t)/2.3)}).join("")}function F(e,r){var i,n,o,a,s,l;switch(C(e)){case"HTMLImageElement":i=t.createElement("canvas"),i.width=e.naturalWidth,i.height=e.naturalHeight,n=i.getContext("2d"),n.drawImage(e,0,0);case"Canvas":case"HTMLCanvasElement":i=i||e,n=n||i.getContext("2d");case"CanvasRenderingContext2D":n=n||e,i=i||n.canvas,o=n.getImageData(0,0,i.width,i.height);case"ImageData":o=o||e,r=o.width,a="CanvasPixelArray"==C(o.data)?new Uint8Array(o.data):o.data;case"Array":case"CanvasPixelArray":a=a||new Uint8Array(e);case"Uint8Array":case"Uint8ClampedArray":a=a||e,s=new Uint32Array(a.buffer);case"Uint32Array":s=s||e,a=a||new Uint8Array(s.buffer),r=r||s.length,l=s.length/r}return{can:i,ctx:n,imgd:o,buf8:a,buf32:s,width:r,height:l}}function M(e,t,r,i){for(var n=e%r,o=t%i,a=e-n,s=t-o,l=[],h=0;t>h;h+=i)for(var d=0;e>d;d+=r)l.push({x:d,y:h,w:d==a?n:r,h:h==s?o:i});return l}function A(e,t,r){var i=e,n=i.y*t+i.x,o=(i.y+i.h-1)*t+(i.x+i.w-1),a=0,s=t-i.w+1,l=n;do r.call(this,l),l+=++a%i.w==0?s:1;while(o>=l)}function O(e,t){var r=[];for(var i in e)r.push(i);return ht.call(r,function(r,i){return t?e[i]-e[r]:e[r]-e[i]})}function E(e,t,r,n){function o(e){var t=e.length;if(2>t||t>256||t&t-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return t}var a=0,n=n===i?{}:n,s=n.loop===i?null:n.loop,l=n.palette===i?null:n.palette;if(0>=t||0>=r||t>65535||r>65535)throw"Width/Height invalid.";e[a++]=71,e[a++]=73,e[a++]=70,e[a++]=56,e[a++]=57,e[a++]=97;var h=0,d=0;if(null!==l){for(var u=o(l);u>>=1;)++h;if(u=1<<h,--h,n.background!==i){if(d=n.background,d>=u)throw"Background index out of range.";if(0===d)throw"Background index explicitly passed as 0."}}if(e[a++]=255&t,e[a++]=t>>8&255,e[a++]=255&r,e[a++]=r>>8&255,e[a++]=(null!==l?128:0)|h,e[a++]=d,e[a++]=0,null!==l)for(var c=0,f=l.length;f>c;++c){var g=l[c];e[a++]=g>>16&255,e[a++]=g>>8&255,e[a++]=255&g}if(null!==s){if(0>s||s>65535)throw"Loop count invalid.";e[a++]=33,e[a++]=255,e[a++]=11,e[a++]=78,e[a++]=69,e[a++]=84,e[a++]=83,e[a++]=67,e[a++]=65,e[a++]=80,e[a++]=69,e[a++]=50,e[a++]=46,e[a++]=48,e[a++]=3,e[a++]=1,e[a++]=255&s,e[a++]=s>>8&255,e[a++]=0}var m=!1;this.addFrame=function(t,r,n,s,h,d){if(m===!0&&(--a,m=!1),d=d===i?{}:d,0>t||0>r||t>65535||r>65535)throw"x/y invalid.";if(0>=n||0>=s||n>65535||s>65535)throw"Width/Height invalid.";if(h.length<n*s)throw"Not enough pixels for the frame size.";var u=!0,c=d.palette;if((c===i||null===c)&&(u=!1,c=l),c===i||null===c)throw"Must supply either a local or global palette.";for(var f=o(c),g=0;f>>=1;)++g;f=1<<g;var p=d.delay===i?0:d.delay,v=d.disposal===i?0:d.disposal;if(0>v||v>3)throw"Disposal out of range.";var b=!1,x=0;if(d.transparent!==i&&null!==d.transparent&&(b=!0,x=d.transparent,0>x||x>=f))throw"Transparent color index.";if((0!==v||b||0!==p)&&(e[a++]=33,e[a++]=249,e[a++]=4,e[a++]=v<<2|(b===!0?1:0),e[a++]=255&p,e[a++]=p>>8&255,e[a++]=x,e[a++]=0),e[a++]=44,e[a++]=255&t,e[a++]=t>>8&255,e[a++]=255&r,e[a++]=r>>8&255,e[a++]=255&n,e[a++]=n>>8&255,e[a++]=255&s,e[a++]=s>>8&255,e[a++]=u===!0?128|g-1:0,u===!0)for(var w=0,y=c.length;y>w;++w){var C=c[w];e[a++]=C>>16&255,e[a++]=C>>8&255,e[a++]=255&C}a=I(e,a,2>g?2:g,h)},this.end=function(){return m===!1&&(e[a++]=59,m=!0),a}}function I(e,t,r,n){function o(r){for(;f>=r;)e[t++]=255&g,g>>=8,f-=8,t===s+256&&(e[s]=255,s=t++)}function a(e){g|=e<<f,f+=c,o(8)}e[t++]=r;var s=t++,l=1<<r,h=l-1,d=l+1,u=d+1,c=r+1,f=0,g=0,m=n[0]&h,p={};a(l);for(var v=1,b=n.length;b>v;++v){var x=n[v]&h,w=m<<8|x,y=p[w];if(y===i){for(g|=m<<f,f+=c;f>=8;)e[t++]=255&g,g>>=8,f-=8,t===s+256&&(e[s]=255,s=t++);4096===u?(a(l),u=d+1,c=r+1,p={}):(u>=1<<c&&++c,p[w]=u++),m=x}else m=y}return a(m),a(d),o(1),s+1===t?e[s]=0:(e[s]=t-s-1,e[t++]=0),t}function W(e,t,r){r=r||{},this.width=e,this.height=t,this.diffMode=0===r.diffMode?0:r.diffMode||1,this.cropBox=r.cropBox,this.background=r.background,this.loop=r.loop,this.frameDelay=r.frameDelay||2,this.loopDelay=r.loopDelay||this.frameDelay,this.palette=r.palette||[0],this.sampleInt=r.sampleInt||1,this.sampleQty=r.sampleQty||30,this.sampleCtr=0,this._tmpCtx=null,this.frames=[],this.stage=null,this.quantOpts=r.quantOpts||{colors:256,method:2,boxSize:[64,64],boxPxls:2,initColors:4096,minHueCols:0,dithKern:null,dithDelta:0,dithSerp:!1,palette:[],reIndex:!1,useCache:!0,cacheFreq:10,colorDist:"euclidean"},this.encOpts=r.encOpts||{},this.quantizer=new f(this.quantOpts),this.encoder=null}function U(e,t,r){var i=j(e,t,r);if(null===i)return null;var n=new Uint32Array(i[2]*i[3]),o=0;return z(i,r,function(r){n[o++]=e[r]===t[r]?0:t[r]}),{data:n,bbox:i}}function T(e,t){var r=H(e,t);return null===r?null:{data:R(e,t,r),bbox:r}}function R(t,r,i){for(var n,o,a=i[0],s=i[1],l=i[2],h=i[3],d=s+h,u=Object.prototype.toString.call(t).slice(8,-1),c=new e[u](l*h),f=s;d>f;f++)n=f*r+a,o=t.subarray(n,n+l),c.set(o,(f-s)*l);return c}function D(e,t,r,i,n){for(var o,a,s=new Uint8Array(i*n),l=t/i,h=r/n,d=0;n>d;d++)for(var u=0;i>u;u++)o=Math.floor(u*l),a=Math.floor(d*h),s[d*i+u]=e[a*t+o];return s}function j(e,t,r){var i=function(r){return e[r]!==t[r]};return P(r,e.length/r,i)}function H(e,t){var r=function(t){return(4278190080&e[t])>>24!=0};return P(t,e.length/t,r)}function P(e,t,r){var i,n,o,a=e*t,s=null,l=null,h=null,d=null;i=0;do if(r(i)){s=~~(i/e);break}while(i++<a);if(null===s)return null;i=a;do if(r(i)){l=~~(i/e);break}while(i-->0);n=0,o=s;do{if(i=e*o+n,r(i)){h=n;break}l>o?o++:(o=0,n++)}while(a>i);n=e-1,o=s;do{if(i=e*o+n,r(i)){d=n;break}l>o?o++:(o=0,n--)}while(i>0);return[h,s,d-h+1,l-s+1]}function z(e,t,r){var i={x:e[0],y:e[1],w:e[2],h:e[3]},n=i.y*t+i.x,o=(i.y+i.h-1)*t+(i.x+i.w-1),a=0,s=t-i.w+1,l=n;do{if(r.call(this,l)===!1)return;l+=++a%i.w==0?s:1}while(o>=l)}function L(e){e=X.isObject(e)?e:{},ct.stopVideoStreaming(e)}function V(e,r){var i=e.options||{},n=i.images,o=i.video,a=Number(i.gifWidth),s=Number(i.gifHeight),l=(Number(i.numFrames),e.cameraStream),h=e.videoElement,d=e.videoWidth,u=e.videoHeight,c=ut.getCropDimensions({videoWidth:d,videoHeight:u,gifHeight:s,gifWidth:a}),f=r;i.crop=c,i.videoElement=h,i.videoWidth=d,i.videoHeight=u,i.cameraStream=l,X.isElement(h)&&(h.width=a+c.width,h.height=s+c.height,i.webcamVideoElement||(X.setCSSAttr(h,{position:"fixed",opacity:"0"}),t.body.appendChild(h)),h.play(),ut.getGIF(i,function(e){n&&n.length||o&&o.length||L(e),f(e)}))}function G(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=e.callback,r=e.existingVideo,n=e.options,o={getUserMedia:!0,"window.URL":!0},a=Q.validate(o),s=void 0,l=void 0;if(a.error)return t(a);if(X.isElement(r)&&r.src){if(l=r.src,s=X.getExtension(l),!X.isSupported.videoCodecs[s])return t(Q.messages.videoCodecs)}else X.isArray(r)&&X.each(r,function(e,t){return s=t instanceof Blob?t.type.substr(t.type.lastIndexOf("/")+1,t.length):t.substr(t.lastIndexOf(".")+1,t.length),X.isSupported.videoCodecs[s]?(r=t,!1):void 0});ct.startStreaming({completed:function(e){e.options=n||{},V(e,t)},existingVideo:r,crossOrigin:n.crossOrigin,options:n})}function B(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=e.callback,r=e.lastCameraStream,n=e.options,a=e.webcamVideoElement;return o()?n.savedRenderingContexts.length?(ut.getGIF(n,function(e){t(e)}),void 0):(ct.startVideoStreaming(function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};e.options=n||{},V(e,t)},{lastCameraStream:r,callback:t,webcamVideoElement:a,crossOrigin:n.crossOrigin}),void 0):t(Q.validate())}function q(e,t){if(t=X.isFunction(e)?e:t,e=X.isObject(e)?e:{},X.isFunction(t)){var r=X.mergeOptions(J,e)||{},i=e.cameraStream,n=r.images,o=n?n.length:0,a=r.video,s=r.webcamVideoElement;r=X.mergeOptions(r,{gifWidth:Math.floor(r.gifWidth),gifHeight:Math.floor(r.gifHeight)}),o?c({images:n,imagesLength:o,callback:t,options:r}):a?G({existingVideo:a,callback:t,options:r}):B({lastCameraStream:i,callback:t,webcamVideoElement:s,options:r})}}function N(e,t){if(t=X.isFunction(e)?e:t,e=X.isObject(e)?e:{},X.isFunction(t)){var r=X.mergeOptions(J,e),i=X.mergeOptions(r,{interval:.1,numFrames:1,gifWidth:Math.floor(r.gifWidth),gifHeight:Math.floor(r.gifHeight)});q(i,t)}}var X={URL:e.URL||e.webkitURL||e.mozURL||e.msURL,getUserMedia:function(){var e=r.getUserMedia||r.webkitGetUserMedia||r.mozGetUserMedia||r.msGetUserMedia;return e?e.bind(r):e}(),requestAnimFrame:e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame,requestTimeout:function(e,t){if(e=e||X.noop,t=t||0,!X.requestAnimFrame)return setTimeout(e,t);var r=(new Date).getTime(),i=new Object,n=X.requestAnimFrame,o=function a(){var o=(new Date).getTime(),s=o-r;s>=t?e.call():i.value=n(a)};return i.value=n(o),i},Blob:e.Blob||e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,btoa:function(){var t=e.btoa||function(e){for(var t="",r=0,i=e.length,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=void 0,a=void 0,s=void 0,l=void 0,h=void 0,d=void 0,u=void 0;i>r;)o=e.charCodeAt(r++),a=e.charCodeAt(r++),s=e.charCodeAt(r++),l=o>>2,h=(3&o)<<4|a>>4,d=(15&a)<<2|s>>6,u=63&s,isNaN(a)?d=u=64:isNaN(s)&&(u=64),t=t+n.charAt(l)+n.charAt(h)+n.charAt(d)+n.charAt(u);return t};return t?t.bind(e):X.noop}(),isObject:function(e){return e&&"[object Object]"===Object.prototype.toString.call(e)},isEmptyObject:function(e){return X.isObject(e)&&!Object.keys(e).length},isArray:function(e){return e&&Array.isArray(e)},isFunction:function(e){return e&&"function"==typeof e},isElement:function(e){return e&&1===e.nodeType},isString:function(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)},isSupported:{canvas:function(){var e=t.createElement("canvas");return e&&e.getContext&&e.getContext("2d")},webworkers:function(){return e.Worker},blob:function(){return X.Blob},Uint8Array:function(){return e.Uint8Array},Uint32Array:function(){return e.Uint32Array},videoCodecs:function(){var e=t.createElement("video"),r={mp4:!1,h264:!1,ogv:!1,ogg:!1,webm:!1};try{e&&e.canPlayType&&(r.mp4=""!==e.canPlayType('video/mp4; codecs="mp4v.20.8"'),r.h264=""!==(e.canPlayType('video/mp4; codecs="avc1.42E01E"')||e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')),r.ogv=""!==e.canPlayType('video/ogg; codecs="theora"'),r.ogg=""!==e.canPlayType('video/ogg; codecs="theora"'),r.webm=-1!==e.canPlayType('video/webm; codecs="vp8, vorbis"'))}catch(i){}return r}()},noop:function(){},each:function(e,t){var r=void 0,i=void 0;if(X.isArray(e))for(r=-1,i=e.length;++r<i&&t(r,e[r])!==!1;);else if(X.isObject(e))for(r in e)if(e.hasOwnProperty(r)&&t(r,e[r])===!1)break},mergeOptions:function(e,t){if(X.isObject(e)&&X.isObject(t)&&Object.keys){var r={};return X.each(e,function(t){r[t]=e[t]}),X.each(t,function(i){var n=t[i];r[i]=X.isObject(n)?e[i]?X.mergeOptions(e[i],n):n:n}),r}},setCSSAttr:function(e,t,r){X.isElement(e)&&(X.isString(t)&&X.isString(r)?e.style[t]=r:X.isObject(t)&&X.each(t,function(t,r){e.style[t]=r}))},removeElement:function(e){X.isElement(e)&&e.parentNode&&e.parentNode.removeChild(e)},createWebWorker:function(e){if(!X.isString(e))return{};try{var t=new X.Blob([e],{type:"text/javascript"}),r=X.URL.createObjectURL(t),i=new Worker(r);return{objectUrl:r,worker:i}}catch(n){return""+n}},getExtension:function(e){return e.substr(e.lastIndexOf(".")+1,e.length)},getFontSize:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};if(!t.body||e.resizeFont===!1)return e.fontSize;var r=e.text,n=e.gifWidth,o=parseInt(e.fontSize,10),a=parseInt(e.minFontSize,10),s=t.createElement("div"),l=t.createElement("span");for(s.setAttribute("width",n),s.appendChild(l),l.innerHTML=r,l.style.fontSize=o+"px",l.style.textIndent="-9999px",l.style.visibility="hidden",t.body.appendChild(l);l.offsetWidth>n&&o>=a;)l.style.fontSize=--o+"px";return t.body.removeChild(l),o+"px"},webWorkerError:!1},Y=Object.freeze({"default":X}),Q={validate:function(e){e=X.isObject(e)?e:{};var t={};return X.each(Q.validators,function(r,i){var n=i.errorCode;return e[n]||i.condition?void 0:(t=i,t.error=!0,!1)}),delete t.condition,t},isValid:function gt(e){var t=Q.validate(e),gt=t.error!==!0?!0:!1;return gt},validators:[{condition:X.isFunction(X.getUserMedia),errorCode:"getUserMedia",errorMsg:"The getUserMedia API is not supported in your browser"},{condition:X.isSupported.canvas(),errorCode:"canvas",errorMsg:"Canvas elements are not supported in your browser"},{condition:X.isSupported.webworkers(),errorCode:"webworkers",errorMsg:"The Web Workers API is not supported in your browser"},{condition:X.isFunction(X.URL),errorCode:"window.URL",errorMsg:"The window.URL API is not supported in your browser"},{condition:X.isSupported.blob(),errorCode:"window.Blob",errorMsg:"The window.Blob File API is not supported in your browser"},{condition:X.isSupported.Uint8Array(),errorCode:"window.Uint8Array",errorMsg:"The window.Uint8Array function constructor is not supported in your browser"},{condition:X.isSupported.Uint32Array(),errorCode:"window.Uint32Array",errorMsg:"The window.Uint32Array function constructor is not supported in your browser"}],messages:{videoCodecs:{errorCode:"videocodec",errorMsg:"The video codec you are trying to use is not supported in your browser"}}},_=Object.freeze({"default":Q}),K=function(){},J={sampleInterval:10,numWorkers:2,filter:"",gifWidth:200,gifHeight:200,interval:.1,numFrames:10,frameDuration:1,keepCameraOn:!1,images:[],video:null,webcamVideoElement:null,cameraStream:null,text:"",fontWeight:"normal",fontSize:"16px",minFontSize:"10px",resizeFont:!1,fontFamily:"sans-serif",fontColor:"#ffffff",textAlign:"center",textBaseline:"bottom",textXCoordinate:null,textYCoordinate:null,progressCallback:K,completeCallback:K,saveRenderingContexts:!1,savedRenderingContexts:[],showFrameText:!0,crossOrigin:"Anonymous",waterMark:null,waterMarkHeight:null,waterMarkWidth:null,waterMarkXCoordinate:1,waterMarkYCoordinate:1},Z=Object.freeze({"default":J}),$=function(){},et=function(e){this.canvas=null,this.ctx=null,this.repeat=0,this.frames=[],this.numRenderedFrames=0,this.onRenderCompleteCallback=$,this.onRenderProgressCallback=$,this.workers=[],this.availableWorkers=[],this.generatingGIF=!1,this.options=e,this.initializeWebWorkers(e)};et.prototype={workerMethods:h(),initializeWebWorkers:function(e){var r=this,i=l.toString()+"("+h.toString()+"());",n=void 0,o=void 0,a=void 0,s=void 0,d=-1,u="";for(s=e.numWorkers;++d<s;)n=X.createWebWorker(i),X.isObject(n)?(o=n.objectUrl,a=n.worker,r.workers.push({worker:a,objectUrl:o}),r.availableWorkers.push(a)):(u=n,X.webWorkerError=!!n);this.workerError=u,this.canvas=t.createElement("canvas"),this.canvas.width=e.gifWidth,this.canvas.height=e.gifHeight,this.ctx=this.canvas.getContext("2d"),this.frames=[]},getWorker:function(){return this.availableWorkers.pop()},freeWorker:function(e){this.availableWorkers.push(e)},byteMap:function(){for(var e=[],t=0;256>t;t++)e[t]=String.fromCharCode(t);return e}(),bufferToString:function(e){for(var t=e.length,r="",i=-1;++i<t;)r+=this.byteMap[e[i]];return r},onFrameFinished:function(e){var t=this,r=t.frames,i=t.options,n=!!(i.images||[]).length,o=r.every(function(e){return!e.beingProcessed&&e.done});t.numRenderedFrames++,n&&e(t.numRenderedFrames/r.length),t.onRenderProgressCallback(.75*t.numRenderedFrames/r.length),o?t.generatingGIF||t.generateGIF(r,t.onRenderCompleteCallback):X.requestTimeout(function(){t.processNextFrame()},1)},processFrame:function(e){var t=this,r=(this.options,this.options),n=r.progressCallback,o=r.sampleInterval,a=this.frames,s=void 0,l=void 0,h=function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},r=e.data;delete s.data,s.pixels=Array.prototype.slice.call(r.pixels),s.palette=Array.prototype.slice.call(r.palette),s.done=!0,s.beingProcessed=!1,t.freeWorker(l),t.onFrameFinished(n)};return s=a[e],s.beingProcessed||s.done?(this.onFrameFinished(),void 0):(s.sampleInterval=o,s.beingProcessed=!0,s.gifshot=!0,l=this.getWorker(),l?(l.onmessage=h,l.postMessage(s)):h({data:t.workerMethods.run(s)}),void 0)},startRendering:function(e){this.onRenderCompleteCallback=e;for(var t=0;t<this.options.numWorkers&&t<this.frames.length;t++)this.processFrame(t)},processNextFrame:function(){for(var e=-1,t=0;t<this.frames.length;t++){var r=this.frames[t];if(!r.done&&!r.beingProcessed){e=t;break}}e>=0&&this.processFrame(e)},generateGIF:function(e,t){var r=[],i={loop:this.repeat},n=this.options,o=n.interval,a=n.frameDuration,s=n.images,l=!!s.length,h=n.gifHeight,u=n.gifWidth,c=new d(r,u,h,i),f=this.onRenderProgressCallback,g=l?100*o:0,m=void 0,p=void 0;this.generatingGIF=!0,X.each(e,function(t,r){var i=r.palette;f(.75+.25*r.position*1/e.length);for(var n=0;a>n;n++)c.addFrame(0,0,u,h,r.pixels,{palette:i,delay:g})}),c.end(),f(1),this.frames=[],this.generatingGIF=!1,X.isFunction(t)&&(m=this.bufferToString(r),p="data:image/gif;base64,"+X.btoa(m),t(p))},setRepeat:function(e){this.repeat=e},addFrame:function(e,t,r){t=X.isObject(t)?t:{};var i=this,n=i.ctx,o=i.options,a=o.gifWidth,s=o.gifHeight,l=X.getFontSize(t),h=t,d=h.filter,u=h.fontColor,c=h.fontFamily,f=h.fontWeight,g=(h.gifHeight,h.gifWidth,h.text),m=h.textAlign,p=h.textBaseline,v=h.waterMark,b=h.waterMarkHeight,x=h.waterMarkWidth,w=h.waterMarkXCoordinate,y=h.waterMarkYCoordinate,C=t.textXCoordinate?t.textXCoordinate:"left"===m?1:"right"===m?a:a/2,k=t.textYCoordinate?t.textYCoordinate:"top"===p?1:"center"===p?s/2:s,S=f+" "+l+" "+c,F=r&&t.showFrameText?r:g,M=void 0;try{n.filter=d,n.drawImage(e,0,0,a,s),F&&(n.font=S,n.fillStyle=u,n.textAlign=m,n.textBaseline=p,n.fillText(F,C,k)),v&&n.drawImage(v,w,y,x,b),M=n.getImageData(0,0,a,s),i.addFrameImageData(M)}catch(A){return""+A}},addFrameImageData:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=this.frames,r=e.data;this.frames.push({data:r,width:e.width,height:e.height,palette:null,dithering:null,done:!1,beingProcessed:!1,position:t.length})},onRenderProgress:function(e){this.onRenderProgressCallback=e},isRendering:function(){return this.generatingGIF},getBase64GIF:function(e){var t=this,r=function(r){t.destroyWorkers(),X.requestTimeout(function(){e(r)},0)};t.startRendering(r)},destroyWorkers:function(){if(!this.workerError){var e=this.workers;X.each(e,function(e,t){var r=t.worker,i=t.objectUrl;r.terminate(),X.URL.revokeObjectURL(i)})}}},f.prototype.sample=function(e,t){if(this.palLocked)throw"Cannot sample additional images, palette already assembled.";var r=F(e,t);switch(this.method){case 1:this.colorStats1D(r.buf32);break;case 2:this.colorStats2D(r.buf32,r.width)}},f.prototype.reduce=function(e,t,r,i){if(this.palLocked||this.buildPal(),r=r||this.dithKern,i="undefined"!=typeof i?i:this.dithSerp,t=t||1,r)var n=this.dither(e,r,i);else for(var o=F(e),a=o.buf32,s=a.length,n=new Uint32Array(s),l=0;s>l;l++){var h=a[l];n[l]=this.nearestColor(h)}if(1==t)return new Uint8Array(n.buffer);if(2==t){for(var d=[],s=n.length,l=0;s>l;l++){var h=n[l];d[l]=this.i32idx[h]}return d}},f.prototype.dither=function(e,t,r){var i={FloydSteinberg:[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]],FalseFloydSteinberg:[[3/8,1,0],[3/8,0,1],[.25,1,1]],Stucki:[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]],Atkinson:[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]],Jarvis:[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]],Burkes:[[.25,1,0],[.125,2,0],[2/32,-2,1],[.125,-1,1],[.25,0,1],[.125,1,1],[2/32,2,1]],Sierra:[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[.125,-1,1],[5/32,0,1],[.125,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]],TwoSierra:[[.25,1,0],[3/16,2,0],[1/16,-2,1],[.125,-1,1],[3/16,0,1],[.125,1,1],[1/16,2,1]],SierraLite:[[.5,1,0],[.25,-1,1],[.25,0,1]]};if(!t||!i[t])throw"Unknown dithering kernel: "+t;for(var n=i[t],o=F(e),a=o.buf32,s=o.width,l=o.height,h=(a.length,r?-1:1),d=0;l>d;d++){r&&(h=-1*h);for(var u=d*s,c=1==h?0:s-1,f=1==h?s:0;c!==f;c+=h){var g=u+c,m=a[g],p=255&m,v=(65280&m)>>8,b=(16711680&m)>>16,x=this.nearestColor(m),w=255&x,y=(65280&x)>>8,C=(16711680&x)>>16;if(a[g]=255<<24|C<<16|y<<8|w,this.dithDelta){var k=this.colorDist([p,v,b],[w,y,C]);if(k<this.dithDelta)continue}for(var S=p-w,M=v-y,A=b-C,O=1==h?0:n.length-1,E=1==h?n.length:0;O!==E;O+=h){var I=n[O][1]*h,W=n[O][2],U=W*s;if(I+c>=0&&s>I+c&&W+d>=0&&l>W+d){var T=n[O][0],R=g+(U+I),D=255&a[R],j=(65280&a[R])>>8,H=(16711680&a[R])>>16,P=Math.max(0,Math.min(255,D+S*T)),z=Math.max(0,Math.min(255,j+M*T)),L=Math.max(0,Math.min(255,H+A*T));a[R]=255<<24|L<<16|z<<8|P}}}}return a},f.prototype.buildPal=function(e){if(!(this.palLocked||this.idxrgb.length>0&&this.idxrgb.length<=this.colors)){var t=this.histogram,r=O(t,!0);if(0==r.length)throw"Nothing has been sampled, palette cannot be built.";switch(this.method){case 1:for(var i=this.initColors,n=r[i-1],o=t[n],a=r.slice(0,i),s=i,l=r.length;l>s&&t[r[s]]==o;)a.push(r[s++]);this.hueStats&&this.hueStats.inject(a);break;case 2:var a=r}a=a.map(function(e){return+e}),this.reducePal(a),!e&&this.reIndex&&this.sortPal(),this.useCache&&this.cacheHistogram(a),this.palLocked=!0}},f.prototype.palette=function(e,t){return this.buildPal(t),e?this.idxrgb:new Uint8Array(new Uint32Array(this.idxi32).buffer)},f.prototype.prunePal=function(e){for(var t,r=0;r<this.idxrgb.length;r++)e[r]||(t=this.idxi32[r],this.idxrgb[r]=null,this.idxi32[r]=null,delete this.i32idx[t]);if(this.reIndex){for(var i=[],n=[],o={},r=0,a=0;r<this.idxrgb.length;r++)this.idxrgb[r]&&(t=this.idxi32[r],i[a]=this.idxrgb[r],o[t]=a,n[a]=t,a++);this.idxrgb=i,this.idxi32=n,this.i32idx=o}},f.prototype.reducePal=function(e){if(this.idxrgb.length>this.colors){for(var t,r=e.length,i={},n=0,o=!1,a=0;r>a;a++)n!=this.colors||o||(this.prunePal(i),o=!0),t=this.nearestIndex(e[a]),n<this.colors&&!i[t]&&(i[t]=!0,n++);o||(this.prunePal(i),o=!0)}else{var s=e.map(function(e){return[255&e,(65280&e)>>8,(16711680&e)>>16]}),r=s.length,l=r,h=this.initDist;if(l>this.colors){for(;l>this.colors;){for(var d=[],a=0;r>a;a++){{var u=s[a];e[a]}if(u)for(var c=a+1;r>c;c++){var f=s[c],g=e[c];if(f){var m=this.colorDist(u,f);h>m&&(d.push([c,f,g,m]),delete s[c],l--)}}}h+=l>3*this.colors?this.initDist:this.distIncr}if(l<this.colors){ht.call(d,function(e,t){return t[3]-e[3]});for(var p=0;l<this.colors;)s[d[p][0]]=d[p][1],l++,p++}}for(var r=s.length,a=0;r>a;a++)s[a]&&(this.idxrgb.push(s[a]),this.idxi32.push(e[a]),this.i32idx[e[a]]=this.idxi32.length-1,this.i32rgb[e[a]]=s[a])}},f.prototype.colorStats1D=function(e){for(var t,r=this.histogram,i=e.length,n=0;i>n;n++)t=e[n],(4278190080&t)>>24!=0&&(this.hueStats&&this.hueStats.check(t),t in r?r[t]++:r[t]=1)},f.prototype.colorStats2D=function(e,t){var r=this.boxSize[0],i=this.boxSize[1],n=r*i,o=M(t,e.length/t,r,i),a=this.histogram,s=this;o.forEach(function(r){var i,o=Math.max(Math.round(r.w*r.h/n)*s.boxPxls,2),l={};A(r,t,function(t){i=e[t],(4278190080&i)>>24!=0&&(s.hueStats&&s.hueStats.check(i),i in a?a[i]++:i in l?++l[i]>=o&&(a[i]=l[i]):l[i]=1)
})}),this.hueStats&&this.hueStats.inject(a)},f.prototype.sortPal=function(){var e=this;this.idxi32.sort(function(t,r){var i=e.i32idx[t],n=e.i32idx[r],o=e.idxrgb[i],a=e.idxrgb[n],s=b(o[0],o[1],o[2]),l=b(a[0],a[1],a[2]),h=o[0]==o[1]&&o[1]==o[2]?-1:x(s.h,e.hueGroups),d=a[0]==a[1]&&a[1]==a[2]?-1:x(l.h,e.hueGroups),u=d-h;if(u)return-u;var c=y(+l.l.toFixed(2))-y(+s.l.toFixed(2));if(c)return-c;var f=w(+l.s.toFixed(2))-w(+s.s.toFixed(2));return f?-f:void 0}),this.idxi32.forEach(function(t,r){e.idxrgb[r]=e.i32rgb[t],e.i32idx[t]=r})},f.prototype.nearestColor=function(e){var t=this.nearestIndex(e);return null===t?0:this.idxi32[t]},f.prototype.nearestIndex=function(e){if((4278190080&e)>>24==0)return null;if(this.useCache&&""+e in this.i32idx)return this.i32idx[e];for(var t,r=1e3,i=[255&e,(65280&e)>>8,(16711680&e)>>16],n=this.idxrgb.length,o=0;n>o;o++)if(this.idxrgb[o]){var a=this.colorDist(i,this.idxrgb[o]);r>a&&(r=a,t=o)}return t},f.prototype.cacheHistogram=function(e){for(var t=0,r=e[t];t<e.length&&this.histogram[r]>=this.cacheFreq;r=e[t++])this.i32idx[r]=this.nearestIndex(r)},g.prototype.check=function(e){this.groupsFull==this.numGroups+1&&(this.check=function(){});var t=255&e,r=(65280&e)>>8,i=(16711680&e)>>16,n=t==r&&r==i?-1:x(b(t,r,i).h,this.numGroups),o=this.stats[n],a=this.minCols;o.num++,o.num>a||(o.num==a&&this.groupsFull++,o.num<=a&&this.stats[n].cols.push(e))},g.prototype.inject=function(e){for(var t=-1;t<this.numGroups;t++)if(this.stats[t].num<=this.minCols)switch(C(e)){case"Array":this.stats[t].cols.forEach(function(t){-1==e.indexOf(t)&&e.push(t)});break;case"Object":this.stats[t].cols.forEach(function(t){e[t]?e[t]++:e[t]=1})}};var tt=.2126,rt=.7152,it=.0722,nt=255,ot=255,at=255,st=Math.sqrt(tt*nt*nt+rt*ot*ot+it*at*at),lt=tt*nt+rt*ot+it*at,ht=S()?Array.prototype.sort:k;W.prototype.addFrame=function(e,t){e instanceof Array||(e=[e]),t=t||{};var r=t.cropBox||this.cropBox||[0,0,e[0].naturalWidth||e[0].width,e[0].naturalHeight||e[0].height],i=this.composeLayers(e,r),n=1==this.diffMode?0:2;if(0==this.diffMode||null===this.stage)var o={bbox:[0,0,r[2],r[3]],data:i};else if(2==this.diffMode)var a=T(i,r[2]),o=a;else var o=U(this.stage,i,r[2]);if(null===o)return this.frames[this.frames.length-1].delay+=t.delay||this.frameDelay,void 0;this.frames.push({bbox:o.bbox,data:o.data,delay:t.delay||this.frameDelay,disp:n,pal:null,indxd:null}),this.stage=i;var s=this.frames.length-1;this.sampleCtr<this.sampleQty&&s%this.sampleInt==0&&(this.quantizer.sample(this.stage),this.sampleCtr++)},W.prototype.getTmpCtx=function(e,r){if(!this._tmpCtx){var i=t.createElement("canvas"),n=i.getContext("2d");i.width=e,i.height=r,this._tmpCtx=n}return this._tmpCtx},W.prototype.composeLayers=function(e,t){var r=t[2],i=t[3],n=this.getTmpCtx(r,i);n.clearRect(0,0,r,i);for(var o in e)n.drawImage(e[o],-t[0],-t[1]);var a=n.getImageData(0,0,r,i);return new Uint32Array(a.data.buffer)},W.prototype.complete=function(){return this.buildPalette(),this.indexFrames(),this.render()},W.prototype.buildPalette=function(){return this.palette=this.quantizer.palette(!0).map(function(e){return(e[0]<<16)+(e[1]<<8)+e[2]}),this.palette.unshift(0),this.palette},W.prototype.indexFrames=function(){for(var e in this.frames)this.frames[e].indxd=this.quantizer.reduce(this.frames[e].data,2).map(function(e){return null===e?0:e+1})},W.prototype.encode=function(){for(var e=1;e<this.palette.length;)e<<=1;this.palette.length=e;var t,r,i=new Uint8Array(1048576),n={loop:this.loop,palette:this.palette},o=new E(i,this.width,this.height,n),a=this.frames.length-1,s=this.width/this.frames[0].bbox[2],l=this.height/this.frames[0].bbox[3];for(var h in this.frames){r=this.frames[h];var d=Math.floor(r.bbox[0]*s),u=Math.floor(r.bbox[1]*l),c=Math.floor(r.bbox[2]*s),f=Math.floor(r.bbox[3]*l);t=D(r.indxd,r.bbox[2],r.bbox[3],c,f);var g={delay:h==a?this.loopDelay:this.frameDelay,transparent:0,disposal:r.disp};o.addFrame(d,u,c,f,t,g)}return i.subarray(0,o.end())},W.prototype.render=function(){var e=t.createElement("img"),r=this.encode();return e.src="data:image/gif;base64,"+base64ArrayBuffer(r),e};var dt=function(){},ut={getGIF:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},r=arguments[1];r=X.isFunction(r)?r:dt;var n=t.createElement("canvas"),o=void 0,a=e.images,s=(!!a.length,e.cameraStream),l=e.crop,h=e.filter,d=e.fontColor,u=e.fontFamily,c=e.fontWeight,f=e.keepCameraOn,g=(e.numWorkers,e.progressCallback),m=e.saveRenderingContexts,p=e.savedRenderingContexts,v=e.text,b=e.textAlign,x=e.textBaseline,w=e.videoElement,y=e.videoHeight,C=e.videoWidth,k=e.webcamVideoElement,S=e.waterMark,F=e.waterMarkHeight,M=e.waterMarkWidth,A=e.waterMarkXCoordinate,O=e.waterMarkYCoordinate,E=Number(e.gifWidth),I=Number(e.gifHeight),U=Number(e.interval),T=(Number(e.sampleInterval),[]),R=p.length?p.length:e.numFrames,D=R;console.log("new gifter");var j=new W({sampleInt:e.sampleInterval,sampleQty:R,loop:0,frameDelay:e.frameDuration,diffMode:1,quantOpts:{method:1}}),H=X.getFontSize(e),P=e.textXCoordinate?e.textXCoordinate:"left"===b?1:"right"===b?E:E/2,z=e.textYCoordinate?e.textYCoordinate:"top"===x?1:"center"===x?I/2:I,L=c+" "+H+" "+u,V=l?Math.floor(l.scaledWidth/2):0,G=l?C-l.scaledWidth:0,B=l?Math.floor(l.scaledHeight/2):0,q=l?y-l.scaledHeight:0,N=0,Y=function(){function e(){try{G>C&&(G=C),q>y&&(q=y),0>V&&(V=0),0>B&&(B=0),o.filter=h,o.drawImage(w,V,B,G,q,0,0,E,I),t()}catch(r){if("NS_ERROR_NOT_AVAILABLE"!==r.name)throw r;X.requestTimeout(e,100)}}function t(){if(m&&T.push(o.getImageData(0,0,E,I)),S&&o.drawImage(S,A,O,M,F),v&&(o.font=L,o.fillStyle=d,o.textAlign=b,o.textBaseline=x,o.fillText(v,P,z)),console.log("Get Image Data"),createImageBitmap(o.getImageData(0,0,E,I)).then(function(e){j.addFrame(e)}),D=i,g((R-D)/R),i>0&&(console.log("Video CurrentTime",w.currentTime),console.log("Capture Single Frame. Interval:",U),console.log("FramesLeft",i),w.currentTime=N+U,N+=U),0===D){console.log("Doing getBase64GIF"),w.pause(),console.log("Render GIFter");var e=j.render();r({error:!1,errorCode:"",errorMsg:"",image:e,cameraStream:s,videoElement:w,webcamVideoElement:k,savedRenderingContexts:T,keepCameraOn:f})}}var i=D-1;p.length?(o.putImageData(p[R-D],0,0),t()):e()};R=R!==i?R:10,U=U!==i?U:.1,n.width=E,n.height=I,o=n.getContext("2d"),w.onseeked=function(){console.log("video seeked",w.currentTime),Y()};var Q=!0;w.onloadeddata=function(){console.log("Video Can Play"),Q&&(Y(),Q=!1)}},getCropDimensions:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=e.videoWidth,r=e.videoHeight,n=e.gifWidth,o=e.gifHeight,a={width:0,height:0,scaledWidth:0,scaledHeight:0};return t>r?(a.width=Math.round(t*(o/r))-n,a.scaledWidth=Math.round(a.width*(r/o))):(a.height=Math.round(r*(n/t))-o,a.scaledHeight=Math.round(a.height*(t/n))),a}},ct={loadedData:!1,defaultVideoDimensions:{width:640,height:480},findVideoSize:function mt(e){mt.attempts=mt.attempts||0;var t=e.cameraStream,r=e.completedCallback,i=e.videoElement;i&&(i.videoWidth>0&&i.videoHeight>0?(i.removeEventListener("loadeddata",ct.findVideoSize),r({videoElement:i,cameraStream:t,videoWidth:i.videoWidth,videoHeight:i.videoHeight})):mt.attempts<10?(mt.attempts+=1,X.requestTimeout(function(){ct.findVideoSize(e)},400)):r({videoElement:i,cameraStream:t,videoWidth:ct.defaultVideoDimensions.width,videoHeight:ct.defaultVideoDimensions.height}))},onStreamingTimeout:function(e){X.isFunction(e)&&e({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - Timed out while trying to start streaming",image:null,cameraStream:{}})},stream:function(e){var t=X.isArray(e.existingVideo)?e.existingVideo[0]:e.existingVideo,r=e.cameraStream,i=e.completedCallback,n=e.streamedCallback,o=e.videoElement;if(X.isFunction(n)&&n(),t){if(X.isString(t))o.src=t,o.innerHTML='<source src="'+t+'" type="video/'+X.getExtension(t)+'" />';else if(t instanceof Blob){try{o.src=X.URL.createObjectURL(t)}catch(a){}o.innerHTML='<source src="'+t+'" type="'+t.type+'" />'}}else if(o.mozSrcObject)o.mozSrcObject=r;else if(X.URL)try{o.srcObject=r,o.src=X.URL.createObjectURL(r)}catch(a){o.srcObject=r}o.play(),X.requestTimeout(function s(){s.count=s.count||0,ct.loadedData===!0?(ct.findVideoSize({videoElement:o,cameraStream:r,completedCallback:i}),ct.loadedData=!1):(s.count+=1,s.count>10?ct.findVideoSize({videoElement:o,cameraStream:r,completedCallback:i}):s())},0)},startStreaming:function(e){var r=X.isFunction(e.error)?e.error:X.noop,i=X.isFunction(e.streamed)?e.streamed:X.noop,n=X.isFunction(e.completed)?e.completed:X.noop,o=e.crossOrigin,a=e.existingVideo,s=e.lastCameraStream,l=e.options,h=e.webcamVideoElement,d=X.isElement(a)?a:h?h:t.createElement("video");o&&(d.crossOrigin=l.crossOrigin),d.autoplay=!0,d.loop=!0,d.muted=!0,d.addEventListener("loadeddata",function(){ct.loadedData=!0,l.offset&&(d.currentTime=l.offset)}),a?ct.stream({videoElement:d,existingVideo:a,completedCallback:n}):s?ct.stream({videoElement:d,cameraStream:s,streamedCallback:i,completedCallback:n}):X.getUserMedia({video:!0},function(e){ct.stream({videoElement:d,cameraStream:e,streamedCallback:i,completedCallback:n})},r)},startVideoStreaming:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:{},r=t.timeout!==i?t.timeout:0,n=t.callback,o=t.webcamVideoElement,a=void 0;r>0&&(a=X.requestTimeout(function(){ct.onStreamingTimeout(n)},1e4)),ct.startStreaming({error:function(){n({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - the user probably denied permission",image:null,cameraStream:{}})},streamed:function(){clearTimeout(a)},completed:function(){var t=arguments.length>0&&arguments[0]!==i?arguments[0]:{},r=t.cameraStream,n=t.videoElement,o=t.videoHeight,a=t.videoWidth;e({cameraStream:r,videoElement:n,videoHeight:o,videoWidth:a})},lastCameraStream:t.lastCameraStream,webcamVideoElement:o,crossOrigin:t.crossOrigin,options:t})},stopVideoStreaming:function(e){e=X.isObject(e)?e:{};var t=e,r=t.keepCameraOn,i=t.videoElement,n=t.webcamVideoElement,o=e.cameraStream||{},a=o.getTracks?o.getTracks()||[]:[],s=!!a.length,l=a[0];!r&&s&&X.isFunction(l.stop)&&l.stop(),X.isElement(i)&&!n&&(i.pause(),X.isFunction(X.URL.revokeObjectURL)&&!X.webWorkerError&&i.src&&X.URL.revokeObjectURL(i.src),X.removeElement(i))}},ft={utils:Y,error:_,defaultOptions:Z,createGIF:q,takeSnapShot:N,stopVideoStreaming:L,isSupported:n,isWebCamGIFSupported:o,isExistingVideoGIFSupported:s,isExistingImagesGIFSupported:a,VERSION:"0.4.5"};"function"==typeof define&&define.amd?define([],function(){return ft}):"undefined"!=typeof exports?module.exports=ft:e.gifshot=ft}("undefined"!=typeof window?window:{},"undefined"!=typeof document?document:{createElement:function(){}},"undefined"!=typeof window?window.navigator:{});